<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AI äººç”Ÿæ¨¡æ‹Ÿå™¨ï¼šæµ®ç”Ÿè‹¥æ¢¦ (ç”Ÿæ´»ç‰ˆ)</title>
    <style>
        :root { --bg: #f5f2e9; --panel: #fdfcf8; --text: #2c2c2c; --primary: #5d5043; --border: #dcd3c1; --accent: #c0a46d; --success: #6b8e23; --danger: #a0522d; --love: #e056fd; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body, html { margin: 0; padding: 0; height: 100%; background: var(--bg); font-family: "Slabo 27px", "STKaiti", "KaiTi", serif; color: var(--text); overflow: hidden; user-select: none; }
        
        /* å¤å¤ç»„ä»¶ */
        .btn-retro { padding: 8px 16px; border: 1px solid var(--primary); background: var(--panel); color: var(--primary); font-size: 15px; cursor: pointer; transition: 0.1s; box-shadow: 2px 2px 0 var(--border); border-radius: 2px; font-family: inherit; font-weight: bold; position: relative; overflow: hidden; }
        .btn-retro:active { transform: translate(1px, 1px); box-shadow: 1px 1px 0 var(--border); }
        .btn-retro:disabled { opacity: 0.6; cursor: not-allowed; background: #eee; color: #999; box-shadow: none; border-color: #ccc; }
        .btn-love { border-color: var(--love); color: var(--love); }
        
        .hidden { display: none !important; }
        .full-panel { position: fixed; inset: 0; background: rgba(245, 242, 233, 0.98); z-index: 1000; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px; overflow-y: auto; }
        .paper-card { background: var(--panel); border: 1px solid var(--border); box-shadow: 6px 6px 0 rgba(0,0,0,0.05); padding: 25px; max-width: 100%; width: 550px; position: relative; max-height: 90vh; overflow-y: auto; }

        /* é¡¶éƒ¨æ  */
        #top-bar { position: fixed; top: 15px; right: 15px; z-index: 2000; display: flex; gap: 10px; }
        .icon-btn { background: rgba(253, 252, 248, 0.9); padding: 6px 12px; border: 1px solid var(--border); cursor: pointer; font-size: 14px; border-radius: 4px; display: flex; align-items: center; gap: 5px; }
        .status-dot { width: 8px; height: 8px; border-radius: 50%; background: #ccc; }
        .status-dot.online { background: var(--success); box-shadow: 0 0 5px var(--success); }

        /* æ»‘å—æ ·å¼ */
        .slider-row { display: flex; align-items: center; gap: 12px; margin-bottom: 20px; }
        .slider-label { width: 45px; font-weight: bold; font-size: 16px; color: var(--primary); }
        .slider-btn { width: 28px; height: 28px; border: 1px solid var(--primary); background: #fff; cursor: pointer; display: flex; align-items: center; justify-content: center; color: var(--primary); font-family: monospace; font-size: 18px; }
        .slider-input { flex: 1; -webkit-appearance: none; height: 6px; background: #e0ddd3; outline: none; margin: 0 5px; border-radius: 3px; border: 1px solid #ccc; }
        .slider-input::-webkit-slider-thumb { -webkit-appearance: none; width: 20px; height: 20px; background: var(--primary); border-radius: 50%; cursor: pointer; border: 2px solid #fff; box-shadow: 0 2px 4px rgba(0,0,0,0.2); transition: transform 0.1s; position: relative; z-index: 2; }
        .slider-val { width: 35px; text-align: right; font-family: monospace; font-size: 18px; font-weight: bold; color: var(--accent); }

        /* æ¸¸æˆä¸»ç•Œé¢ */
        #game-view { display: flex; height: 100vh; width: 100vw; max-width: 1200px; margin: 0 auto; border-left: 1px solid var(--border); border-right: 1px solid var(--border); }
        .side-bar { width: 320px; background: #f2efe4; border-right: 1px solid var(--border); padding: 20px; display: flex; flex-direction: column; overflow-y: auto; flex-shrink: 0; }
        .log-area { flex: 1; background: var(--bg); position: relative; display: flex; flex-direction: column; overflow: hidden; }
        
        /* ä¾§è¾¹æ ä¿¡æ¯ */
        .info-block { margin-bottom: 20px; padding-bottom: 15px; border-bottom: 2px dashed var(--border); }
        .info-row { display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 15px; }
        .info-val { font-weight: bold; color: var(--text); }

        /* åŠŸèƒ½æŒ‰é’®åŒº */
        .action-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; margin-top: 10px; }
        .action-btn { padding: 10px 5px; font-size: 14px; display: flex; flex-direction: column; align-items: center; gap: 5px; }

        /* çŠ¶æ€æ¡ */
        .stat-group { margin-bottom: 10px; }
        .stat-label { display: flex; justify-content: space-between; font-size: 13px; margin-bottom: 4px; color: #555; }
        .stat-progress { height: 8px; background: #e6e2d3; border: 1px solid rgba(0,0,0,0.05); border-radius: 2px; }
        .stat-fill { height: 100%; background: var(--primary); transition: 0.5s; width: 0%; }

        /* æ—¥å¿— */
        #event-log { flex: 1; overflow-y: auto; padding: 30px; scroll-behavior: smooth; -webkit-overflow-scrolling: touch; }
        .year-block { margin-bottom: 25px; border-left: 3px solid var(--border); padding-left: 18px; animation: fadeIn 0.5s ease; }
        .year-num { font-size: 20px; font-weight: bold; color: var(--primary); margin-bottom: 6px; font-family: "KaiTi", serif; }
        .year-text { font-size: 17px; line-height: 1.6; color: #333; text-align: justify; }
        
        /* åˆ—è¡¨æ ·å¼ */
        .list-item { display: flex; justify-content: space-between; align-items: center; padding: 12px; border-bottom: 1px solid #eee; background: #fff; margin-bottom: 8px; border-radius: 4px; box-shadow: 0 1px 2px rgba(0,0,0,0.05); }
        .list-info { flex: 1; }
        .list-actions { display: flex; gap: 5px; }
        .item-name { font-weight: bold; color: var(--primary); }
        .heart-val { color: var(--love); font-weight: bold; font-size: 13px; margin-left: 5px; }
        .rel-tag { font-size: 11px; padding: 2px 4px; border-radius: 3px; background: #eee; color: #666; margin-left: 5px; }
        .item-desc { font-size: 12px; color: #888; margin-top: 2px; }
        .item-effect { font-size: 11px; color: var(--success); margin-top: 2px; font-weight: bold; }

        /* ç»“å±€æ ·å¼ (ç»å…¸ç‰ˆ) */
        .death-summary { text-align: left; background: #fff; padding: 20px; border-radius: 4px; border: 1px solid #eee; margin-bottom: 20px; font-size: 15px; line-height: 1.8; color: #444; max-height: 300px; overflow-y: auto; }
        .epitaph { font-size: 24px; font-family: "KaiTi"; color: var(--primary); margin: 30px 0; font-style: italic; text-align: center; border-top: 1px solid #ddd; border-bottom: 1px solid #ddd; padding: 20px 0; }

        /* èŠå¤©çª—å£æ ·å¼ */
        .chat-input-area { display: flex; gap: 10px; margin-top: 20px; }
        .chat-input { flex: 1; padding: 10px; border: 1px solid var(--border); border-radius: 4px; font-family: inherit; }
        .chat-bubble { display: inline-block; padding: 8px 12px; border-radius: 8px; max-width: 80%; text-align: left; word-break: break-word; line-height: 1.4; }
        .chat-msg-user { text-align: right; margin: 10px 0; }
        .chat-msg-npc { text-align: left; margin: 10px 0; }

        /* ====================
        1. ä¿®å¤ Toast (æç¤ºæ°”æ³¡)
        ç‹¬ç«‹äºç§»åŠ¨ç«¯é€‚é…ï¼Œç¡®ä¿å®ƒæ°¸è¿œåœ¨æœ€ä¸Šå±‚å±…ä¸­
        ==================== */
        #toast {
            position: fixed;
            top: 20%; /* è·ç¦»é¡¶éƒ¨ 20% çš„ä½ç½®ï¼Œæ¯”æ­£ä¸­é—´æ›´ç¬¦åˆé˜…è¯»ä¹ æƒ¯ */
            left: 50%;
            transform: translateX(-50%); /* æ°´å¹³å±…ä¸­ */
            background: rgba(0, 0, 0, 0.85); /* æ·±è‰²èƒŒæ™¯ */
            color: #fff;
            padding: 10px 20px;
            border-radius: 25px; /* åœ†è§’æ°”æ³¡ */
            z-index: 99999; /* ã€å…³é”®ã€‘å±‚çº§è®¾ä¸ºæœ€é«˜ï¼Œé˜²æ­¢è¢«é®æŒ¡ */
            opacity: 0;
            visibility: hidden; /* é»˜è®¤ä¸å¯è§ï¼Œé˜²æ­¢è¯¯è§¦ */
            transition: opacity 0.3s, top 0.3s;
            font-size: 14px;
            pointer-events: none; /* é¼ æ ‡ç©¿é€ï¼Œä¸æŒ¡æ“ä½œ */
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            white-space: nowrap; /* é˜²æ­¢æ–‡å­—æ¢è¡Œ */
        }

        /* Toast æ˜¾ç¤ºæ—¶çš„çŠ¶æ€ (JSä¼šåˆ‡æ¢è¿™ä¸ªç±») */
        #toast.show {
            opacity: 1;
            visibility: visible;
            top: 22%; /* ç¨å¾®æœ‰ä¸ªä¸‹æ²‰åŠ¨ç”» */
        }

        /* ====================
        CSS ä¼ªå…¨å±æ¨¡å¼ (Bè®¡åˆ’)
        ==================== */
        body.fake-fullscreen {
            overflow: hidden; /* ç¦æ­¢èƒŒæ™¯æ»šåŠ¨ */
        }

        body.fake-fullscreen #game-view {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            width: 100vw !important;
            height: 100vh !important;
            z-index: 99999 !important; /* ç¡®ä¿åœ¨æœ€æœ€ä¸Šå±‚ */
            background: var(--bg, #fff) !important; /* é˜²æ­¢é€æ˜ */
            margin: 0 !important;
            
            /* é‡æ–°è°ƒæ•´å†…è¾¹è·ï¼Œé€‚åº”å…¨å±çŠ¶æ€ */
            padding-top: 60px !important; 
            padding-bottom: 80px !important;
        }

        /* ä¼ªå…¨å±æ¨¡å¼ä¸‹ï¼Œç¡®ä¿é¡¶éƒ¨æ å’Œåº•éƒ¨æ ä¹Ÿåœ¨æœ€ä¸Šå±‚ */
        body.fake-fullscreen #top-bar,
        body.fake-fullscreen #controls {
            position: fixed !important;
            z-index: 100000 !important; /* æ¯” game-view æ›´é«˜ */
            left: 0 !important;
            width: 100% !important;
        }

       /* --- ç§»åŠ¨ç«¯ç»ˆæä¿®å¤ç‰ˆ (é˜²é®æŒ¡ + å¼¹çª—é€‚é…) --- */
        @media (max-width: 768px) {

            /* 1. å…¨å±€å¸ƒå±€ï¼šå¼ºåˆ¶ç•™å‡ºé¡¶éƒ¨å’Œåº•éƒ¨ç©ºé—´ */
            #game-view {
                display: flex;
                flex-direction: column;
                width: 100%;
                height: 100%;
                box-sizing: border-box;
                
                /* ã€æ ¸å¿ƒä¿®å¤ã€‘é¡¶éƒ¨ç•™å‡º 70pxï¼Œå½»åº•è§£å†³é¡¶éƒ¨æ é®æŒ¡é—®é¢˜ */
                padding-top: 70px; 
                /* åº•éƒ¨ç•™å‡º 90pxï¼Œé˜²æ­¢æŒ‰é’®é®æŒ¡æ—¥å¿— */
                padding-bottom: 90px; 
            }

            /* 2. é¡¶éƒ¨æ ï¼šå›ºå®šåœ¨é¡¶éƒ¨ï¼Œå·¦å¯¹é½ */
            #top-bar {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 50px;
                background: var(--bg);
                border-bottom: 1px solid var(--border);
                z-index: 2000; /* å±‚çº§æé«˜ */
                
                display: flex;
                align-items: center;
                justify-content: flex-start; /* å·¦å¯¹é½ */
                padding: 0 15px;
                gap: 10px;
            }

            /* é¡¶éƒ¨æŒ‰é’®æ ·å¼ */
            .icon-btn {
                height: 32px;
                padding: 0 10px;
                background: var(--btn-bg, #f0f0f0);
                border: 1px solid var(--border, #ccc);
                border-radius: 4px;
                font-size: 13px;
                display: inline-flex;
                align-items: center;
                justify-content: center;
            }
            .icon-btn span { display: inline-block !important; margin-left: 4px; }
            #status-text { display: none; }

            /* ã€æ–°å¢ã€‘ç§»åŠ¨ç«¯éšè—å…¨å±æŒ‰é’® (å› ä¸ºiframeå†…é€šå¸¸æ— æ³•è§¦å‘å…¨å±) */
            #fullscreen-btn, .fa-expand {
                display: none !important;
            }

            /* 3. å±æ€§æ  */
            .side-bar {
                flex-shrink: 0; /* ç¦æ­¢å‹ç¼© */
                width: 100%;
                padding: 10px 15px;
                border-bottom: 1px solid var(--border);
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 8px;
                background: var(--bg);
            }
            .info-block { margin: 0; border: none; padding: 0; font-size: 14px; }

            /* 4. æ—¥å¿—åŒº */
            #event-log {
                flex-grow: 1;
                overflow-y: auto; /* å…è®¸å†…éƒ¨æ»šåŠ¨ */
                padding: 15px;
                font-size: 15px;
                line-height: 1.6;
                -webkit-overflow-scrolling: touch;
            }

            /* 5. åº•éƒ¨æŒ‰é’®åŒº */
            #controls {
                position: fixed;
                bottom: 0;
                left: 0;
                width: 100%;
                background: var(--bg);
                border-top: 1px solid var(--border);
                padding: 15px 20px;
                padding-bottom: calc(20px + env(safe-area-inset-bottom));
                z-index: 2000;
                display: flex;
                justify-content: center;
            }

            #next-btn {
                width: 100%;
                max-width: 400px;
                padding: 12px 0;
                font-size: 16px;
                background: var(--btn-bg, #fff);
                color: var(--text, #333);
                border: 1px solid var(--border, #ccc);
                border-radius: 4px;
            }

            /* =========================================
            6. ã€æ ¸å¿ƒä¿®å¤ã€‘å¼¹çª—ä¸å¤©èµ‹é€‰æ‹©é€‚é…
            ========================================= */
            
            /* å¼ºåˆ¶å¼¹çª—å®¹å™¨é ä¸Šï¼Œè€Œä¸æ˜¯å±…ä¸­ */
            #choice-modal {
                display: flex !important;
                align-items: flex-start !important; /* é é¡¶éƒ¨å¯¹é½ */
                padding-top: 80px !important; /* é¿å¼€é¡¶éƒ¨æ  */
                background: rgba(0,0,0,0.6); /* èƒŒæ™¯é®ç½© */
                z-index: 3000; /* ç¡®ä¿åœ¨æœ€æœ€ä¸Šå±‚ */
            }

            /* å¼¹çª—å†…å®¹æ¡† */
            #choice-content {
                width: 90%; /* å®½åº¦å æ»¡ */
                max-height: 75vh; /* é™åˆ¶é«˜åº¦ï¼Œé˜²æ­¢è¶…å‡ºä¸€å± */
                overflow-y: auto; /* å†…å®¹å¤šäº†å¯ä»¥æ»š */
                margin: 0 auto;
                padding: 15px;
                border-radius: 8px;
                background: var(--bg);
            }

            /* æ ‡é¢˜æ  */
            #choice-content h3 {
                margin-top: 0;
                font-size: 1.2rem;
                text-align: center;
            }

            /* é€‰é¡¹æŒ‰é’®/å¤©èµ‹å—ï¼šå˜å°ã€å˜ç´§å‡‘ */
            .choice-btn, .talent-item {
                width: 100%;
                margin: 8px 0;
                padding: 10px; /* å‡å°å†…è¾¹è· */
                font-size: 14px; /* å‡å°å­—å· */
                text-align: left;
                border: 1px solid var(--border);
                border-radius: 4px;
                background: var(--btn-bg);
                
                /* å¦‚æœæ˜¯å¤©èµ‹é€‰æ‹©ï¼Œå°è¯•è®©å®ƒä»¬å¹¶æ’ (å¯é€‰) */
                /* display: flex; align-items: center; */
            }

            /* é’ˆå¯¹å¤©èµ‹åˆ—è¡¨å®¹å™¨ (å¦‚æœæœ‰ç‰¹å®šclass) */
            #talent-list {
                display: grid;
                grid-template-columns: 1fr; /* æ‰‹æœºä¸Šä¸€è¡Œä¸€ä¸ªï¼Œé˜²æ­¢æŒ¤å‹ */
                gap: 8px;
            }

            /* 3. å¤©èµ‹é€‰é¡¹å—ï¼šæç®€ç˜¦èº«ç‰ˆ */
            .talent-item, .choice-btn {
                padding: 6px 8px !important; /* æå°çš„å†…è¾¹è· */
                margin-bottom: 6px !important; /* å‡å°é—´è· */
                min-height: auto !important; /* å»æ‰æœ€å°é«˜åº¦é™åˆ¶ */
                
                display: flex !important;
                flex-direction: column !important; /* å‚ç›´æ’åˆ— */
                justify-content: center !important;
            }

            /* å¤©èµ‹åç§° */
            .talent-item .name, .choice-btn .title {
                font-size: 13px !important; /* æ ‡é¢˜å˜å° */
                font-weight: bold;
                margin-bottom: 2px;
            }

            /* å¤©èµ‹æè¿° */
            .talent-item .desc, .choice-btn .content {
                font-size: 11px !important; /* æè¿°æ–‡å­—å˜å¾—éå¸¸å° */
                color: #666;
                line-height: 1.3;
                margin: 0;
            }

            /* é€‰ä¸­çŠ¶æ€ */
            .talent-item.selected {
                border-color: #f00 !important;
                background-color: #fff0f0 !important;
            }
        }
    </style>
</head>
<body>

    <!-- é¡¶éƒ¨æ  -->
    <div id="top-bar">
        <div class="icon-btn" onclick="toggleFullScreen()" style="margin-right: 10px;">
            <span id="fs-icon">â›¶</span>
        </div>
        <div class="icon-btn" onclick="confirmRestart()" style="margin-right: auto;">
            <span>ğŸ”„ é‡å¼€</span>
        </div>
        <div class="icon-btn" onclick="toggleAudio()">
            <span id="audio-icon">ğŸ”Š</span>
        </div>
        <div class="icon-btn" onclick="toggleSettings()">
            <div id="status-dot" class="status-dot"></div>
            <span id="status-text">æ£€æµ‹ä¸­</span>
            <span>âš™ï¸</span>
        </div>
    </div>

    <div id="toast">æç¤ºä¿¡æ¯</div>

    <!-- è®¾ç½®é¢æ¿ -->
    <div id="p-settings" class="full-panel hidden" style="z-index: 3000;">
        <div class="paper-card">
            <h2 style="color:var(--primary); margin-top:0;">AI é…ç½®</h2>
            <input type="text" id="api-url" placeholder="API URL" style="width:100%; padding:10px; margin-bottom:10px; border:1px solid #ccc; background:#fdfcf8; font-family:inherit;">
            <input type="password" id="api-key" placeholder="API Key" style="width:100%; padding:10px; margin-bottom:10px; border:1px solid #ccc; background:#fdfcf8; font-family:inherit;">
            <input type="text" id="api-model" placeholder="Model Name" style="width:100%; padding:10px; margin-bottom:20px; border:1px solid #ccc; background:#fdfcf8; font-family:inherit;">
            <div style="display:flex; gap:10px;">
                <button class="btn-retro" style="flex:1;" onclick="testConnection()">æµ‹è¯•è¿æ¥</button>
                <button class="btn-retro" style="flex:1;" onclick="saveSettings()">ä¿å­˜</button>
                <button class="btn-retro" style="flex:1;" onclick="toggleSettings()">å…³é—­</button>
            </div>
        </div>
    </div>

    <!-- 1. å¤©èµ‹é€‰æ‹© -->
    <div id="p-traits" class="full-panel">
        <h1 style="color:var(--primary); margin-bottom:10px; font-size: 36px;">æµ®ç”Ÿè‹¥æ¢¦</h1>
        <p id="trait-loading-text" style="color:#666; margin-bottom:30px; font-style:italic;">å‘½è¿çš„éª°å­å·²ç»æ·ä¸‹...</p>
        <div id="traits-list" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 15px; width: 100%; max-width: 800px;"></div>
        <button id="btn-to-stats" class="btn-retro hidden" style="margin-top: 40px; padding: 12px 40px;" onclick="goStats()">ä»¥æ­¤å…¥ä¸–</button>
    </div>

    <!-- 2. å±æ€§åˆ†é… -->
    <div id="p-stats" class="full-panel hidden">
        <div class="paper-card">
            <h2 style="text-align: center; color:var(--primary)">å…ˆå¤©å±æ€§ (0-100)</h2>
            <div style="text-align: center; margin-bottom: 30px;">
                å¯ç”¨ç‚¹æ•°ï¼š<b id="pts-rem" style="color:var(--accent); font-size: 28px;">--</b>
                <div style="font-size:12px; color:#999; margin-top:5px;">(éšæœºèŒƒå›´: 20-80)</div>
            </div>
            
            <div id="sliders-area"></div>

            <div style="display: flex; gap: 15px; margin-top: 30px;">
                <button class="btn-retro" style="flex:1;" onclick="autoAllocate()">ğŸ² å¬å¤©ç”±å‘½</button>
                <button class="btn-retro" style="flex:1;" onclick="startGame()">é™ä¸´äººé—´</button>
            </div>
        </div>
    </div>

    <!-- 3. æ¸¸æˆä¸»ç•Œé¢ -->
    <div id="game-view" class="hidden">
        <div class="side-bar">
            <div class="info-block">
                <div class="info-row">
                    <span>æ€§åˆ«</span><span class="info-val" id="disp-gender">?</span>
                </div>
                <div class="info-row">
                    <span>å­¦å†</span><span class="info-val" id="disp-edu">æœªå…¥å­¦</span>
                </div>
                <div class="info-row">
                    <span>èŒä¸š</span><span class="info-val" id="disp-job">æ— ä¸š</span>
                </div>
                <div class="info-row">
                    <span>å¹´è–ª</span><span class="info-val" id="disp-salary">ï¿¥0</span>
                </div>
                <div class="info-row" style="margin-top:15px; color:var(--danger);">
                    <span>èµ„äº§</span><span class="info-val" id="money-txt">ï¿¥0</span>
                </div>
            </div>
            
            <div id="stat-bars" style="width: 100%;"></div>

            <div class="action-grid">
                <button class="btn-retro action-btn" onclick="openModal('p-relations')">ğŸ‘¥ å…³ç³»</button>
                <button class="btn-retro action-btn" onclick="openModal('p-shop')">ğŸª å•†åº—</button>
                <button class="btn-retro action-btn" onclick="openModal('p-pets')">ğŸ¾ å® ç‰©</button>
            </div>
        </div>
        
        <div class="log-area">
            <div id="choice-overlay" style="position: absolute; inset: 0; background: rgba(245,242,233,0.98); z-index: 100; display: none; flex-direction: column; align-items: center; justify-content: center; padding: 20px;">
                <h2 id="choice-title" style="margin-bottom: 30px; color: var(--primary); text-align:center;"></h2>
                <div id="choice-btns" style="width: 100%; max-width: 400px; display: flex; flex-direction: column; gap: 12px;"></div>
            </div>
            
            <div id="event-log"></div>
            
            <div style="padding: 20px; border-top: 1px solid var(--border); background: var(--panel); text-align: center;">
                <button id="next-btn" class="btn-retro" style="width: 100%; max-width: 300px; padding: 12px;" onclick="tick()">æ¨è¿›å²æœˆ</button>
            </div>
        </div>
    </div>

    <!-- æ¨¡æ€æ¡†ï¼šå…³ç³» -->
    <div id="p-relations" class="full-panel hidden">
        <div class="paper-card">
            <h2 style="color:var(--primary); margin-top:0;">äººé™…å…³ç³»</h2>
            <div style="text-align:center;color:#666;font-size:12px;margin-bottom:10px;" id="chat-limit-text"></div>
            <div id="npc-list"></div>
            <button class="btn-retro" style="width:100%; margin-top:20px;" onclick="closeModal('p-relations')">è¿”å›</button>
        </div>
    </div>

    <!-- æ¨¡æ€æ¡†ï¼šèŠå¤© -->
    <div id="p-chat" class="full-panel hidden">
        <div class="paper-card">
            <h2 id="chat-npc-name" style="color:var(--primary); margin-top:0; text-align:center;"></h2>
            <div id="chat-history" style="padding:15px; border:1px solid var(--border); background:#fff; height:250px; overflow-y:auto; margin-bottom:15px; border-radius:4px; overflow-x: hidden;">
                <div style="text-align:center; color:#999; font-size:12px;">- å¯¹è¯å¼€å§‹ -</div>
            </div>
            <div class="chat-input-area">
                <input type="text" id="chat-input" class="chat-input" placeholder="è¯´ç‚¹ä»€ä¹ˆ..." onkeydown="if(event.key==='Enter') sendChat(false)">
                <button class="btn-retro" onclick="sendChat(false)">å‘é€</button>
            </div>
            <div style="display:flex; gap:10px; margin-top:10px;">
                <button class="btn-retro" style="flex:1; font-size:12px;" onclick="sendChat(true)">âœ¨ AI å¸®æˆ‘å†™</button>
                <button class="btn-retro" style="flex:1; font-size:12px;" onclick="closeModal('p-chat')">ç»“æŸå¯¹è¯</button>
            </div>
        </div>
    </div>

    <!-- æ¨¡æ€æ¡†ï¼šå•†åº— -->
    <div id="p-shop" class="full-panel hidden">
        <div class="paper-card">
            <h2 style="color:var(--primary); margin-top:0;">æ—¶å…‰å•†åº—</h2>
            <div style="text-align:center;color:#666;font-size:12px;margin-bottom:10px;">(å•†å“æ¯å¹´éšæœºåˆ·æ–°ï¼Œå”®å®Œå³æ­¢)</div>
            <div id="shop-list"></div>
            <button class="btn-retro" style="width:100%; margin-top:20px;" onclick="closeModal('p-shop')">è¿”å›</button>
        </div>
    </div>

    <!-- æ¨¡æ€æ¡†ï¼šå® ç‰© -->
    <div id="p-pets" class="full-panel hidden">
        <div class="paper-card">
            <h2 style="color:var(--primary); margin-top:0;">æˆ‘çš„å® ç‰©</h2>
            <div style="text-align:center; color:#666; font-size:12px; margin-bottom:10px;">(æ¯å¹´ä»…é™ç©è€1æ¬¡)</div>
            <div id="pet-list"></div>
            <button class="btn-retro" style="width:100%; margin-top:20px;" onclick="closeModal('p-pets')">è¿”å›</button>
        </div>
    </div>

    <!-- 4. ç»“å±€ (ç»å…¸ç‰ˆ) -->
    <div id="p-death" class="full-panel hidden">
        <div style="font-size: 40px; color: var(--danger); margin-bottom:20px; font-family: 'KaiTi';">å°˜åŸƒè½å®š</div>
        <div id="final-rank" style="font-size: 20px; color:var(--primary); margin-bottom: 20px; font-weight:bold;"></div>
        
        <div class="epitaph" id="final-epitaph"></div>
        <div class="death-summary" id="final-summary">æ­£åœ¨ç”Ÿæˆäººç”Ÿèµ°é©¬ç¯...</div>
        
        <button class="btn-retro" onclick="location.reload()">å†å…¥è½®å›</button>
    </div>
<script src="LifeSimulatorLogic.js"></script>
</body>
</html>